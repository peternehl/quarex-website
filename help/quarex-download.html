<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quarex Seed Creator - Build Living Books & Custom Contexts</title>
  <style>
    :root {
      --bg: #0A0A0A;
      --ink: #F7F7F7;
      --muted: #B7BCC2;
      --line: #262626;
      --card: #111111;
      --accent: #E6E6E6;
      --brand: #EDEDED;
      --blue: #3B82F6;
      --orange: #f59e0b;
      --green: #10b981;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--ink);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      text-align: center;
      padding: 20px 0 30px;
      border-bottom: 2px solid var(--line);
    }

    h1 {
      margin: 0 0 8px;
      font-size: clamp(24px, 4vw, 36px);
      color: var(--brand);
      font-weight: 700;
    }

    .subtitle {
      color: var(--muted);
      font-size: 1rem;
      margin: 0;
    }

    /* Tab Navigation */
    .tab-nav {
      display: flex;
      gap: 8px;
      margin: 30px 0 20px;
      border-bottom: 2px solid var(--line);
    }

    .tab-btn {
      padding: 12px 24px;
      background: transparent;
      border: none;
      color: var(--muted);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.2s;
    }

    .tab-btn:hover {
      color: var(--ink);
      background: rgba(255, 255, 255, 0.05);
    }

    .tab-btn.active {
      color: var(--blue);
      border-bottom-color: var(--blue);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Form Styles */
    .form-section {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .form-section h2 {
      margin: 0 0 16px;
      font-size: 1.3rem;
      color: var(--brand);
    }

    .form-row {
      margin-bottom: 16px;
    }

    label {
      display: block;
      margin-bottom: 6px;
      color: var(--muted);
      font-size: 0.95rem;
      font-weight: 500;
    }

    input[type="text"],
    select,
    textarea {
      width: 100%;
      padding: 10px 12px;
      background: #121212;
      border: 1px solid #242424;
      border-radius: 6px;
      color: var(--ink);
      font-size: 1rem;
      font-family: inherit;
      outline: none;
      transition: border-color 0.15s;
    }

    input[type="text"]:focus,
    select:focus,
    textarea:focus {
      border-color: var(--blue);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
    }

    textarea {
      min-height: 100px;
      resize: vertical;
    }

    /* Buttons */
    .btn {
      padding: 10px 20px;
      background: var(--blue);
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn:hover {
      background: #2563eb;
      transform: translateY(-1px);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background: #374151;
    }

    .btn-secondary:hover {
      background: #4b5563;
    }

    .btn-success {
      background: var(--green);
    }

    .btn-success:hover {
      background: #059669;
    }

    .btn-small {
      padding: 6px 12px;
      font-size: 0.85rem;
    }

    .btn-icon {
      padding: 8px 16px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    /* Dynamic Lists */
    .chapter-item,
    .subcontext-item {
      background: #1a1a1a;
      border: 1px solid #2a2a2a;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .chapter-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .topic-list {
      margin-top: 12px;
    }

    .topic-item {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }

    .topic-item input {
      flex: 1;
    }

    /* JSON Preview */
    .json-preview {
      background: #0d0d0d;
      border: 1px solid var(--line);
      border-radius: 8px;
      padding: 16px;
      margin: 20px 0;
      max-height: 400px;
      overflow-y: auto;
    }

    .json-preview pre {
      margin: 0;
      color: var(--ink);
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    /* Instructions */
    .instructions {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
    }

    .instructions h3 {
      margin: 0 0 8px;
      color: var(--blue);
      font-size: 1.1rem;
    }

    .instructions ul {
      margin: 8px 0;
      padding-left: 20px;
      color: var(--muted);
    }

    .instructions li {
      margin: 4px 0;
    }

    /* Success Message */
    .success-message {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid var(--green);
      border-radius: 8px;
      padding: 12px 16px;
      margin: 16px 0;
      color: var(--green);
      font-weight: 600;
      display: none;
    }

    .success-message.show {
      display: block;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 12px;
      }

      .tab-btn {
        padding: 10px 16px;
        font-size: 0.9rem;
      }

      .form-section {
        padding: 16px;
      }

      .action-buttons {
        flex-direction: column;
      }

      .btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Quarex Seed Creator</h1>
      <p class="subtitle">Build Living Books & Custom Contexts for the Quarex Community</p>
    </header>

    <!-- Tab Navigation -->
    <div class="tab-nav">
      <button class="tab-btn active" data-tab="living-book">Living Book Creator</button>
      <button class="tab-btn" data-tab="context">Context Creator</button>
    </div>

    <!-- Living Book Creator Tab -->
    <div class="tab-content active" id="living-book">
      <div class="instructions">
        <h3>How to Create a Living Book</h3>
        <ul>
          <li>Select a library category (General Knowledge, Critical Thinking, etc.)</li>
          <li>Choose or create a shelf within that library</li>
          <li>Give your book a title</li>
          <li>Add chapters with 5 topics each (the iceberg method - start broad, drill deeper)</li>
          <li>Preview the JSON, download it, or submit to the community</li>
        </ul>
      </div>

      <div class="form-section">
        <h2>Book Details</h2>
        <div class="form-row">
          <label for="library">Library Category*</label>
          <select id="library">
            <option value="">-- Select Library --</option>
            <option value="General Knowledge">General Knowledge</option>
            <option value="Critical Thinking">Critical Thinking</option>
            <option value="Current Events">Current Events</option>
            <option value="Personal & Life">Personal & Life</option>
            <option value="Practical Skills">Practical Skills</option>
          </select>
        </div>

        <div class="form-row">
          <label for="shelf">Shelf Name*</label>
          <input type="text" id="shelf" placeholder="e.g., Software & Technical Tools">
        </div>

        <div class="form-row">
          <label for="bookTitle">Book Title*</label>
          <input type="text" id="bookTitle" placeholder="e.g., AutoCAD 2D">
        </div>
      </div>

      <div class="form-section">
        <h2>Chapters & Topics</h2>
        <div id="chapters-container"></div>
        <button class="btn btn-secondary btn-icon" id="addChapter">
          <span>+</span> Add Chapter
        </button>
      </div>

      <div class="form-section">
        <h2>JSON Preview</h2>
        <div class="json-preview">
          <pre id="jsonPreview">{ "library": "", "shelves": [] }</pre>
        </div>
      </div>

      <div class="success-message" id="successMessage"></div>

      <div class="action-buttons">
        <button class="btn btn-success" id="downloadJSON">Download JSON</button>
        <button class="btn" id="submitBook">Submit to Community</button>
        <button class="btn btn-secondary" id="resetBook">Reset Form</button>
      </div>
    </div>

    <!-- Context Creator Tab -->
    <div class="tab-content" id="context">
      <div class="instructions">
        <h3>How to Create a Custom Context</h3>
        <ul>
          <li>Choose a category for your context set</li>
          <li>Create multiple main contexts (broad topic areas)</li>
          <li>Each main context can have its own sub-contexts</li>
          <li>New main contexts copy sub-contexts from the previous one as a starting point</li>
          <li>Preview the JSON, download it, or submit to the community</li>
        </ul>
      </div>

      <div class="form-section">
        <h2>Category</h2>
        <div class="form-row">
          <label for="contextCategory">Category Name*</label>
          <input type="text" id="contextCategory" placeholder="e.g., Technology, Science, Business">
        </div>
      </div>

      <div class="form-section">
        <h2>Main Contexts</h2>
        <div id="maincontexts-container"></div>
        <button class="btn btn-secondary btn-icon" id="addMainContext">
          <span>+</span> Add Main Context
        </button>
      </div>

      <div class="form-section">
        <h2>JSON Preview</h2>
        <div class="json-preview">
          <pre id="contextJsonPreview">{ "category": "", "mainContexts": [] }</pre>
        </div>
      </div>

      <div class="success-message" id="contextSuccessMessage"></div>

      <div class="action-buttons">
        <button class="btn btn-success" id="downloadContextJSON">Download JSON</button>
        <button class="btn" id="submitContext">Submit to Community</button>
        <button class="btn btn-secondary" id="resetContext">Reset Form</button>
      </div>
    </div>

    <footer style="text-align:center; margin-top:40px; padding:20px 0; border-top:1px solid var(--line); color:var(--muted); font-size:0.9em;">
      © 2025 Quarex / Peter Nehl. All Rights Reserved.
    </footer>
  </div>

  <script>
    // Tab Switching
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');

    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const targetTab = btn.dataset.tab;

        // Update active states
        tabButtons.forEach(b => b.classList.remove('active'));
        tabContents.forEach(c => c.classList.remove('active'));

        btn.classList.add('active');
        document.getElementById(targetTab).classList.add('active');
      });
    });

    // ========================================
    // LIVING BOOK CREATOR
    // ========================================

    const library = document.getElementById('library');
    const shelf = document.getElementById('shelf');
    const bookTitle = document.getElementById('bookTitle');
    const chaptersContainer = document.getElementById('chapters-container');
    const addChapterBtn = document.getElementById('addChapter');
    const jsonPreview = document.getElementById('jsonPreview');
    const downloadJSONBtn = document.getElementById('downloadJSON');
    const submitBookBtn = document.getElementById('submitBook');
    const resetBookBtn = document.getElementById('resetBook');
    const successMessage = document.getElementById('successMessage');

    let chapters = [];

    // Add Chapter
    addChapterBtn.addEventListener('click', () => {
      const chapterIndex = chapters.length;
      chapters.push({
        name: '',
        topics: ['', '', '', '', '']
      });
      renderChapters();
      updateJSONPreview();
    });

    // Render Chapters
    function renderChapters() {
      chaptersContainer.innerHTML = '';
      chapters.forEach((chapter, idx) => {
        const chapterDiv = document.createElement('div');
        chapterDiv.className = 'chapter-item';
        chapterDiv.innerHTML = `
          <div class="chapter-header">
            <input type="text" placeholder="Chapter ${idx + 1} Title" value="${chapter.name}"
                   onchange="updateChapter(${idx}, 'name', this.value)">
            <button class="btn btn-small btn-secondary" onclick="removeChapter(${idx})">Remove</button>
          </div>
          <div class="topic-list">
            <label style="font-size: 0.9rem; color: var(--muted); margin-bottom: 8px; display: block;">Topics (5 per chapter)</label>
            ${chapter.topics.map((topic, topicIdx) => `
              <div class="topic-item">
                <input type="text" placeholder="Topic ${topicIdx + 1}" value="${topic}"
                       onchange="updateTopic(${idx}, ${topicIdx}, this.value)">
              </div>
            `).join('')}
          </div>
        `;
        chaptersContainer.appendChild(chapterDiv);
      });
    }

    // Update Chapter
    window.updateChapter = (idx, field, value) => {
      chapters[idx][field] = value;
      updateJSONPreview();
    };

    // Update Topic
    window.updateTopic = (chapterIdx, topicIdx, value) => {
      chapters[chapterIdx].topics[topicIdx] = value;
      updateJSONPreview();
    };

    // Remove Chapter
    window.removeChapter = (idx) => {
      chapters.splice(idx, 1);
      renderChapters();
      updateJSONPreview();
    };

    // Update JSON Preview
    function updateJSONPreview() {
      const json = {
        library: library.value,
        shelves: library.value && shelf.value ? [{
          name: shelf.value,
          books: [{
            name: bookTitle.value,
            chapters: chapters.map(ch => ({
              name: ch.name,
              topics: ch.topics.filter(t => t.trim() !== '')
            })).filter(ch => ch.name.trim() !== '')
          }]
        }] : []
      };
      jsonPreview.textContent = JSON.stringify(json, null, 2);
    }

    // Update preview on input changes
    library.addEventListener('change', updateJSONPreview);
    shelf.addEventListener('input', updateJSONPreview);
    bookTitle.addEventListener('input', updateJSONPreview);

    // Download JSON
    downloadJSONBtn.addEventListener('click', () => {
      const json = jsonPreview.textContent;
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      const filename = bookTitle.value.trim()
        ? `${bookTitle.value.replace(/\s+/g, '_')}_BOOK.json`
        : 'living_book.json';
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);

      showSuccess('JSON downloaded successfully!');
    });

    // Submit to Community
    submitBookBtn.addEventListener('click', () => {
      if (!library.value || !shelf.value || !bookTitle.value || chapters.length === 0) {
        alert('Please fill in all required fields and add at least one chapter.');
        return;
      }

      // TODO: Implement actual submission to community (could be email, form submission, etc.)
      const json = jsonPreview.textContent;
      const subject = encodeURIComponent(`Living Book Submission: ${bookTitle.value}`);
      const body = encodeURIComponent(`I would like to submit this Living Book to the Quarex community:\n\nBook Title: ${bookTitle.value}\nLibrary: ${library.value}\nShelf: ${shelf.value}\n\nJSON:\n${json}`);
      window.open(`mailto:peter@quarex.org?subject=${subject}&body=${body}`, '_blank');

      showSuccess('Opening email client to submit your Living Book!');
    });

    // Reset Form
    resetBookBtn.addEventListener('click', () => {
      if (confirm('Are you sure you want to reset the form? All data will be lost.')) {
        library.value = '';
        shelf.value = '';
        bookTitle.value = '';
        chapters = [];
        renderChapters();
        updateJSONPreview();
        showSuccess('Form reset successfully!');
      }
    });

    // Show Success Message
    function showSuccess(message) {
      successMessage.textContent = message;
      successMessage.classList.add('show');
      setTimeout(() => {
        successMessage.classList.remove('show');
      }, 4000);
    }

    // ========================================
    // CONTEXT CREATOR
    // ========================================

    const contextCategory = document.getElementById('contextCategory');
    const mainContextsContainer = document.getElementById('maincontexts-container');
    const addMainContextBtn = document.getElementById('addMainContext');
    const contextJsonPreview = document.getElementById('contextJsonPreview');
    const downloadContextJSONBtn = document.getElementById('downloadContextJSON');
    const submitContextBtn = document.getElementById('submitContext');
    const resetContextBtn = document.getElementById('resetContext');
    const contextSuccessMessage = document.getElementById('contextSuccessMessage');

    let mainContexts = [];

    // Add Main Context
    addMainContextBtn.addEventListener('click', () => {
      // Copy sub-contexts from previous main context if exists
      const prevSubContexts = mainContexts.length > 0
        ? [...mainContexts[mainContexts.length - 1].subContexts]
        : ['', '', ''];

      mainContexts.push({
        name: '',
        description: '',
        subContexts: prevSubContexts
      });
      renderMainContexts();
      updateContextJSONPreview();
    });

    // Render Main Contexts
    function renderMainContexts() {
      mainContextsContainer.innerHTML = '';
      mainContexts.forEach((mainContext, mcIdx) => {
        const mainContextDiv = document.createElement('div');
        mainContextDiv.className = 'chapter-item';
        mainContextDiv.innerHTML = `
          <div class="chapter-header">
            <input type="text" placeholder="Main Context ${mcIdx + 1} Name" value="${mainContext.name}"
                   onchange="updateMainContext(${mcIdx}, 'name', this.value)" style="flex: 1; margin-right: 8px;">
            <button class="btn btn-small btn-secondary" onclick="removeMainContext(${mcIdx})">Remove</button>
          </div>
          <div style="margin-bottom: 12px;">
            <label style="font-size: 0.9rem; color: var(--muted); margin-bottom: 6px; display: block;">Description</label>
            <textarea placeholder="Describe this main context..." onchange="updateMainContext(${mcIdx}, 'description', this.value)"
                      style="width: 100%; min-height: 60px;">${mainContext.description}</textarea>
          </div>
          <div class="topic-list">
            <label style="font-size: 0.9rem; color: var(--muted); margin-bottom: 8px; display: block;">Sub-Contexts</label>
            ${mainContext.subContexts.map((subContext, scIdx) => `
              <div class="topic-item">
                <input type="text" placeholder="Sub-Context ${scIdx + 1}" value="${subContext}"
                       onchange="updateSubContext(${mcIdx}, ${scIdx}, this.value)">
                <button class="btn btn-small btn-secondary" onclick="removeSubContext(${mcIdx}, ${scIdx})">×</button>
              </div>
            `).join('')}
            <button class="btn btn-small btn-secondary" onclick="addSubContext(${mcIdx})" style="margin-top: 8px;">+ Add Sub-Context</button>
          </div>
        `;
        mainContextsContainer.appendChild(mainContextDiv);
      });
    }

    // Update Main Context
    window.updateMainContext = (mcIdx, field, value) => {
      mainContexts[mcIdx][field] = value;
      updateContextJSONPreview();
    };

    // Update Sub-Context
    window.updateSubContext = (mcIdx, scIdx, value) => {
      mainContexts[mcIdx].subContexts[scIdx] = value;
      updateContextJSONPreview();
    };

    // Add Sub-Context to specific Main Context
    window.addSubContext = (mcIdx) => {
      mainContexts[mcIdx].subContexts.push('');
      renderMainContexts();
      updateContextJSONPreview();
    };

    // Remove Main Context
    window.removeMainContext = (mcIdx) => {
      mainContexts.splice(mcIdx, 1);
      renderMainContexts();
      updateContextJSONPreview();
    };

    // Remove Sub-Context
    window.removeSubContext = (mcIdx, scIdx) => {
      mainContexts[mcIdx].subContexts.splice(scIdx, 1);
      renderMainContexts();
      updateContextJSONPreview();
    };

    // Update Context JSON Preview
    function updateContextJSONPreview() {
      const json = {
        category: contextCategory.value,
        mainContexts: mainContexts.map(mc => ({
          name: mc.name,
          description: mc.description,
          subContexts: mc.subContexts.filter(sc => sc.trim() !== '')
        })).filter(mc => mc.name.trim() !== '')
      };
      contextJsonPreview.textContent = JSON.stringify(json, null, 2);
    }

    // Update preview on category input
    contextCategory.addEventListener('input', updateContextJSONPreview);

    // Download Context JSON
    downloadContextJSONBtn.addEventListener('click', () => {
      const json = contextJsonPreview.textContent;
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      const filename = contextCategory.value.trim()
        ? `${contextCategory.value.replace(/\s+/g, '_')}_CONTEXT.json`
        : 'context_set.json';
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);

      showContextSuccess('JSON downloaded successfully!');
    });

    // Submit Context to Community
    submitContextBtn.addEventListener('click', () => {
      if (!contextCategory.value || mainContexts.length === 0) {
        alert('Please fill in category and add at least one main context.');
        return;
      }

      const json = contextJsonPreview.textContent;
      const subject = encodeURIComponent(`Context Set Submission: ${contextCategory.value}`);
      const body = encodeURIComponent(`I would like to submit this Context Set to the Quarex community:\n\nCategory: ${contextCategory.value}\nMain Contexts: ${mainContexts.length}\n\nJSON:\n${json}`);
      window.open(`mailto:peter@quarex.org?subject=${subject}&body=${body}`, '_blank');

      showContextSuccess('Opening email client to submit your Context Set!');
    });

    // Reset Context Form
    resetContextBtn.addEventListener('click', () => {
      if (confirm('Are you sure you want to reset the form? All data will be lost.')) {
        contextCategory.value = '';
        mainContexts = [];
        renderMainContexts();
        updateContextJSONPreview();
        showContextSuccess('Form reset successfully!');
      }
    });

    // Show Context Success Message
    function showContextSuccess(message) {
      contextSuccessMessage.textContent = message;
      contextSuccessMessage.classList.add('show');
      setTimeout(() => {
        contextSuccessMessage.classList.remove('show');
      }, 4000);
    }

    // Initialize
    updateJSONPreview();
    updateContextJSONPreview();
  </script>
</body>
</html>
