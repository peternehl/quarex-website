### Step-by-Step Update Process

### Step 1: Scrape Data from Ballotpedia

**IMPORTANT: Scrape in batches of 5 states at a time!**


Do Not Use a python scaper for this, you must manually use your AI to find the candidates instead.


Scraping all 50 states at once will cause context/memory issues. Instead:
1. Scrape 5 states
2. Save to `states-X.json` immediately
3. Repeat for next 5 states

This ensures data is preserved even if something fails mid-process.

Scrape each state's House election page. The URL pattern is:

https://ballotpedia.org/United_States_House_of_Representatives_elections_in_<State>,_2026


For each state, extract:
- All districts
- All candidates per district, grouped by party
- Exclude candidates marked "withdrew" or "did not make ballot"

**Save scraped data immediately after each batch** (5 states per batch):

```
scrapers/states-1.json   # Alabama, Alaska, Arizona, Arkansas, California
scrapers/states-2.json   # Colorado, Connecticut, Delaware, Florida, Georgia
scrapers/states-3.json   # Hawaii, Idaho, Illinois, Indiana, Iowa
scrapers/states-4.json   # Kansas, Kentucky, Louisiana, Maine, Maryland
scrapers/states-5.json   # Massachusetts, Michigan, Minnesota, Mississippi, Missouri
scrapers/states-6.json   # Montana, Nebraska, Nevada, New Hampshire, New Jersey
scrapers/states-7.json   # New Mexico, New York, North Carolina, North Dakota, Ohio
scrapers/states-8.json   # Oklahoma, Oregon, Pennsylvania, Rhode Island, South Carolina
scrapers/states-9.json   # South Dakota, Tennessee, Texas, Utah, Vermont
scrapers/states-10.json  # Virginia, Washington, West Virginia, Wisconsin, Wyoming
```

**Why 10 batch files?**
- Prevents data loss if scraping is interrupted
- Avoids AI context/memory limits when processing large amounts of data
- Allows re-scraping individual batches without redoing everything
- Each batch file serves as checkpoint - save after EVERY 5 states

Batch file format:
```json
{
  "batch": 1,
  "scraped": "2026-01-17",
  "states": [
    {
      "state": "Alabama",
      "abbrev": "AL",
      "districts": [
        {
          "district": "AL-01",
          "candidates": {
            "Republican": ["Jerry Carl (R)", "James Dees (R)"],
            "Democratic": ["Clyde Jones (D)"],
            "Independent": [],
            "Libertarian": [],
            "Green": []
          }
        }
      ]
    }
  ]
}
```

### Step 2: Generate State Book Files (CRITICAL!)

**This is the most important step.** Run the state book generator:

```bash
cd E:\projects\websites\Quarex\scrapers
node generate-state-books.js
```

This creates the 50 state book files (e.g., `alabama.json`) that the app actually uses for navigation. Without these files, clicking on a state will show "Failed to load book" error.

### Step 3: Generate District Files (Optional Backup)

Run the district generation script for each batch:

```bash
cd E:\projects\websites\Quarex\scrapers

node generate-house-districts.js 1
node generate-house-districts.js 2
node generate-house-districts.js 3
node generate-house-districts.js 4
node generate-house-districts.js 5
node generate-house-districts.js 6
node generate-house-districts.js 7
node generate-house-districts.js 8
node generate-house-districts.js 9
node generate-house-districts.js 10
```

This creates the district files in state subfolders (e.g., `alabama/al-01.json`). These are backup/reference files with party-based chapters. They are NOT required for the app to work.

### Step 4: Verify Manifests

Ensure these manifests exist and are correct:

**Library manifest** (`us-house-2026-complete/_manifest.json`):
```json
[
  {
    "slug": "2026-states",
    "name": "2026 House States",
    "description": "All House districts with declared 2026 candidates",
    "bookCount": 50
  }
]
```

**Shelf manifest** (`2026-states/_manifest.json`):
```json
[
  {"slug": "alabama", "name": "Alabama", "chapterCount": 7},
  {"slug": "alaska", "name": "Alaska", "chapterCount": 1},
  ...
]
```

The `chapterCount` is the number of districts in that state.

### Step 5: Rebuild Discovery Index

```bash
cd E:\projects\websites\Quarex
node libraries/_utils/build-discovery-index-v2.js
```

### Step 6: Upload to Server

Upload these files to quarex.org:
- `libraries/politician-libraries/us-house-2026-complete/_manifest.json`
- `libraries/politician-libraries/us-house-2026-complete/2026-states/_manifest.json`
- `libraries/politician-libraries/us-house-2026-complete/2026-states/*.json` (all 50 state book files)
- `libraries/discovery-index.json`

Optionally upload district subfolders (`alabama/`, etc.) if you want backup data on server.

## Scripts Reference

### generate-state-books.js (REQUIRED)

**Location:** `scrapers/generate-state-books.js`

**Usage:** `node generate-state-books.js`

**What it does:**
1. Reads all 10 batch files (`states-1.json` through `states-10.json`)
2. For each state, creates a state book file (e.g., `alabama.json`) with:
   - Districts as chapters
   - All candidates as topics (mixed parties)
3. Reports progress to console

**Example output:**
```
Processing batch 1...
  Alabama - 7 districts
  Alaska - 1 districts
  ...
✓ Complete: 50 state book files created
```

### generate-house-districts.js (Optional)

**Location:** `scrapers/generate-house-districts.js`

**Usage:** `node generate-house-districts.js <batch-number>`

**What it does:**
1. Reads `states-{batch}.json`
2. For each state in the batch:
   - Creates state directory if needed
   - Creates district JSON files with party-based chapters
   - Updates state folder's `_manifest.json`
3. Reports progress to console

## Common Issues & Solutions

### Issue: "Failed to load book" error when clicking a state
**Cause:** The state book file (e.g., `alabama.json`) is missing
**Solution:** Run `node generate-state-books.js` to create the state book files

### Issue: App shows stale/old data
**Cause:** State book files weren't regenerated after scraping
**Solution:** Re-run `node generate-state-books.js`

### Issue: Clicking state works but districts show no candidates
**Cause:** State book file has empty topics arrays
**Solution:** Ensure `generate-state-books.js` includes candidates in topics (check the script)

### Issue: Script fails mid-batch
**Solution:** You can re-run any individual batch without affecting others. Scripts overwrite existing files.

### Issue: Missing candidates after update
**Check:**
1. Verify the source batch file (`states-X.json`) has the candidates
2. Ensure candidate wasn't marked "withdrew" or "did not make ballot" on Ballotpedia
3. Re-scrape that state's batch if needed, then re-run `generate-state-books.js`

### Issue: Shelf manifest missing or wrong
**Solution:** Create `2026-states/_manifest.json` with all 50 states listed. Each entry needs:
- `slug`: lowercase state name with hyphens (e.g., `new-york`)
- `name`: display name (e.g., `New York`)
- `chapterCount`: number of districts

### Issue: Scraping gets interrupted or AI loses context
**Solution:** This is why we use 10 batch files!
1. Always save to `states-X.json` after every 5 states
2. If interrupted, check which batch files exist
3. Resume scraping from the next batch
4. The batch files preserve all progress

### Issue: Tried to scrape all 50 states at once
**Problem:** AI context limits cause data loss or errors
**Solution:** NEVER try to scrape all states at once. Always do 5 states → save → next 5 states → save

## State Batches Quick Reference

| Batch | States |
|-------|--------|
| 1 | Alabama, Alaska, Arizona, Arkansas, California |
| 2 | Colorado, Connecticut, Delaware, Florida, Georgia |
| 3 | Hawaii, Idaho, Illinois, Indiana, Iowa |
| 4 | Kansas, Kentucky, Louisiana, Maine, Maryland |
| 5 | Massachusetts, Michigan, Minnesota, Mississippi, Missouri |
| 6 | Montana, Nebraska, Nevada, New Hampshire, New Jersey |
| 7 | New Mexico, New York, North Carolina, North Dakota, Ohio |
| 8 | Oklahoma, Oregon, Pennsylvania, Rhode Island, South Carolina |
| 9 | South Dakota, Tennessee, Texas, Utah, Vermont |
| 10 | Virginia, Washington, West Virginia, Wisconsin, Wyoming |

## District Counts by State

- 1 district (at-large): AK, DE, ND, SD, VT, WY
- 2 districts: HI, ID, ME, MT, NH, RI, WV
- 3 districts: NE, NM
- 4 districts: AR, IA, KS, LA, NV, UT
- 5 districts: CT, OK
- 6 districts: KY, OR
- 7 districts: AL, SC
- 8 districts: AZ, CO, MD, MN, MO, WI
- 9 districts: IN, MA, TN
- 10 districts: WA
- 11 districts: VA
- 12 districts: NJ
- 13 districts: MI
- 14 districts: GA, NC
- 15 districts: OH
- 17 districts: IL, PA
- 26 districts: NY
- 28 districts: FL
- 38 districts: TX
- 52 districts: CA

**Total: 435 districts**

## Last Updated

- **Date:** January 17, 2026
- **Source:** Ballotpedia
- **Batch files:** `states-1.json` through `states-10.json`
## Step-by-Step Update Process

### Step 1: Scrape Data from Ballotpedia

**IMPORTANT: Scrape in batches of 5 states at a time!**

Scraping all 50 states at once will cause context/memory issues. Instead:
1. Scrape 5 states
2. Save to `states-X.json` immediately
3. Repeat for next 5 states

This ensures data is preserved even if something fails mid-process.

Scrape each state's House election page. The URL pattern is:
```
https://ballotpedia.org/United_States_House_of_Representatives_elections_in_<State>,_2026
```

For each state, extract:
- All districts
- All candidates per district, grouped by party
- Exclude candidates marked "withdrew" or "did not make ballot"

**Save scraped data immediately after each batch** (5 states per batch):

```
scrapers/states-1.json   # Alabama, Alaska, Arizona, Arkansas, California
scrapers/states-2.json   # Colorado, Connecticut, Delaware, Florida, Georgia
scrapers/states-3.json   # Hawaii, Idaho, Illinois, Indiana, Iowa
scrapers/states-4.json   # Kansas, Kentucky, Louisiana, Maine, Maryland
scrapers/states-5.json   # Massachusetts, Michigan, Minnesota, Mississippi, Missouri
scrapers/states-6.json   # Montana, Nebraska, Nevada, New Hampshire, New Jersey
scrapers/states-7.json   # New Mexico, New York, North Carolina, North Dakota, Ohio
scrapers/states-8.json   # Oklahoma, Oregon, Pennsylvania, Rhode Island, South Carolina
scrapers/states-9.json   # South Dakota, Tennessee, Texas, Utah, Vermont
scrapers/states-10.json  # Virginia, Washington, West Virginia, Wisconsin, Wyoming
```

**Why 10 batch files?**
- Prevents data loss if scraping is interrupted
- Avoids AI context/memory limits when processing large amounts of data
- Allows re-scraping individual batches without redoing everything
- Each batch file serves as checkpoint - save after EVERY 5 states

Batch file format:
```json
{
  "batch": 1,
  "scraped": "2026-01-17",
  "states": [
    {
      "state": "Alabama",
      "abbrev": "AL",
      "districts": [
        {
          "district": "AL-01",
          "candidates": {
            "Republican": ["Jerry Carl (R)", "James Dees (R)"],
            "Democratic": ["Clyde Jones (D)"],
            "Independent": [],
            "Libertarian": [],
            "Green": []
          }
        }
      ]
    }
  ]
}
```

### Step 2: Generate State Book Files (CRITICAL!)

**This is the most important step.** Run the state book generator:

```bash
cd E:\projects\websites\Quarex\scrapers
node generate-state-books.js
```

This creates the 50 state book files (e.g., `alabama.json`) that the app actually uses for navigation. Without these files, clicking on a state will show "Failed to load book" error.

### Step 3: Generate District Files (Optional Backup)

Run the district generation script for each batch:

```bash
cd E:\projects\websites\Quarex\scrapers

node generate-house-districts.js 1
node generate-house-districts.js 2
node generate-house-districts.js 3
node generate-house-districts.js 4
node generate-house-districts.js 5
node generate-house-districts.js 6
node generate-house-districts.js 7
node generate-house-districts.js 8
node generate-house-districts.js 9
node generate-house-districts.js 10
```

This creates the district files in state subfolders (e.g., `alabama/al-01.json`). These are backup/reference files with party-based chapters. They are NOT required for the app to work.

### Step 4: Verify Manifests

Ensure these manifests exist and are correct:

**Library manifest** (`us-house-2026-complete/_manifest.json`):
```json
[
  {
    "slug": "2026-states",
    "name": "2026 House States",
    "description": "All House districts with declared 2026 candidates",
    "bookCount": 50
  }
]
```

**Shelf manifest** (`2026-states/_manifest.json`):
```json
[
  {"slug": "alabama", "name": "Alabama", "chapterCount": 7},
  {"slug": "alaska", "name": "Alaska", "chapterCount": 1},
  ...
]
```

The `chapterCount` is the number of districts in that state.

### Step 5: Rebuild Discovery Index

```bash
cd E:\projects\websites\Quarex
node libraries/_utils/build-discovery-index-v2.js
```

### Step 6: Upload to Server

Upload these files to quarex.org:
- `libraries/politician-libraries/us-house-2026-complete/_manifest.json`
- `libraries/politician-libraries/us-house-2026-complete/2026-states/_manifest.json`
- `libraries/politician-libraries/us-house-2026-complete/2026-states/*.json` (all 50 state book files)
- `libraries/discovery-index.json`

Optionally upload district subfolders (`alabama/`, etc.) if you want backup data on server.

## Scripts Reference

### generate-state-books.js (REQUIRED)

**Location:** `scrapers/generate-state-books.js`

**Usage:** `node generate-state-books.js`

**What it does:**
1. Reads all 10 batch files (`states-1.json` through `states-10.json`)
2. For each state, creates a state book file (e.g., `alabama.json`) with:
   - Districts as chapters
   - All candidates as topics (mixed parties)
3. Reports progress to console

**Example output:**
```
Processing batch 1...
  Alabama - 7 districts
  Alaska - 1 districts
  ...
✓ Complete: 50 state book files created
```

### generate-house-districts.js (Optional)

**Location:** `scrapers/generate-house-districts.js`

**Usage:** `node generate-house-districts.js <batch-number>`

**What it does:**
1. Reads `states-{batch}.json`
2. For each state in the batch:
   - Creates state directory if needed
   - Creates district JSON files with party-based chapters
   - Updates state folder's `_manifest.json`
3. Reports progress to console

## Common Issues & Solutions

### Issue: "Failed to load book" error when clicking a state
**Cause:** The state book file (e.g., `alabama.json`) is missing
**Solution:** Run `node generate-state-books.js` to create the state book files

### Issue: App shows stale/old data
**Cause:** State book files weren't regenerated after scraping
**Solution:** Re-run `node generate-state-books.js`

### Issue: Clicking state works but districts show no candidates
**Cause:** State book file has empty topics arrays
**Solution:** Ensure `generate-state-books.js` includes candidates in topics (check the script)

### Issue: Script fails mid-batch
**Solution:** You can re-run any individual batch without affecting others. Scripts overwrite existing files.

### Issue: Missing candidates after update
**Check:**
1. Verify the source batch file (`states-X.json`) has the candidates
2. Ensure candidate wasn't marked "withdrew" or "did not make ballot" on Ballotpedia
3. Re-scrape that state's batch if needed, then re-run `generate-state-books.js`

### Issue: Shelf manifest missing or wrong
**Solution:** Create `2026-states/_manifest.json` with all 50 states listed. Each entry needs:
- `slug`: lowercase state name with hyphens (e.g., `new-york`)
- `name`: display name (e.g., `New York`)
- `chapterCount`: number of districts

### Issue: Scraping gets interrupted or AI loses context
**Solution:** This is why we use 10 batch files!
1. Always save to `states-X.json` after every 5 states
2. If interrupted, check which batch files exist
3. Resume scraping from the next batch
4. The batch files preserve all progress

### Issue: Tried to scrape all 50 states at once
**Problem:** AI context limits cause data loss or errors
**Solution:** NEVER try to scrape all states at once. Always do 5 states → save → next 5 states → save

## State Batches Quick Reference

| Batch | States |
|-------|--------|
| 1 | Alabama, Alaska, Arizona, Arkansas, California |
| 2 | Colorado, Connecticut, Delaware, Florida, Georgia |
| 3 | Hawaii, Idaho, Illinois, Indiana, Iowa |
| 4 | Kansas, Kentucky, Louisiana, Maine, Maryland |
| 5 | Massachusetts, Michigan, Minnesota, Mississippi, Missouri |
| 6 | Montana, Nebraska, Nevada, New Hampshire, New Jersey |
| 7 | New Mexico, New York, North Carolina, North Dakota, Ohio |
| 8 | Oklahoma, Oregon, Pennsylvania, Rhode Island, South Carolina |
| 9 | South Dakota, Tennessee, Texas, Utah, Vermont |
| 10 | Virginia, Washington, West Virginia, Wisconsin, Wyoming |

## District Counts by State

- 1 district (at-large): AK, DE, ND, SD, VT, WY
- 2 districts: HI, ID, ME, MT, NH, RI, WV
- 3 districts: NE, NM
- 4 districts: AR, IA, KS, LA, NV, UT
- 5 districts: CT, OK
- 6 districts: KY, OR
- 7 districts: AL, SC
- 8 districts: AZ, CO, MD, MN, MO, WI
- 9 districts: IN, MA, TN
- 10 districts: WA
- 11 districts: VA
- 12 districts: NJ
- 13 districts: MI
- 14 districts: GA, NC
- 15 districts: OH
- 17 districts: IL, PA
- 26 districts: NY
- 28 districts: FL
- 38 districts: TX
- 52 districts: CA

**Total: 435 districts**

## Last Updated

- **Date:** January 17, 2026
- **Source:** Ballotpedia
- **Batch files:** `states-1.json` through `states-10.json`
